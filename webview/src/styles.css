:root {
    color-scheme: dark;
    --ease-smooth: cubic-bezier(0.22, 1, 0.36, 1);
    --zoom-duration: 320ms;
}

body,
html,
#root {
    margin: 0;
    height: 100%;
    background: #0b0e12;
    color: #cdd6f4;
    font-family: ui-sans-serif, system-ui, Segoe UI, Roboto, Inter, sans-serif;
}

.root {
    height: 100%;
}

.toolbar {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 10;
    display: flex;
    gap: 6px;
}

.toolbar button {
    background: #111827;
    border: 1px solid #1f2937;
    color: #e5e7eb;
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
}

.file-node {
    width: 100%;
    height: 100%;
    background: #0d1117;
    border: 1px solid #1f2937;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 0 1px #0b1220 inset;
}

.file-node-header {
    background: #0b1220;
    padding: 6px 10px;
    font-weight: 600;
    font-size: 12px;
    letter-spacing: .3px;
    border-bottom: 1px solid #1f2937;
    cursor: grab;
}

.code-card {
    height: calc(100% - 30px);
    overflow: auto;
}

.code-card .file-title {
    display: none;
}

pre.hljs {
    margin: 0;
    padding: 8px 10px 8px 56px;
    /* leave space for gutter */
    font-size: 12px;
    line-height: 1.35;
    position: relative;
    counter-reset: line;
}

pre.hljs .code-line {
    display: block;
    counter-increment: line;
    position: relative;
}

pre.hljs .code-line::before {
    content: counter(line);
    position: absolute;
    left: -44px;
    width: 36px;
    text-align: right;
    color: #6b7280;
    opacity: 0.9;
}

pre.hljs .code-line.highlight {
    background: rgba(255, 214, 10, 0.15);
    outline: 1px solid rgba(255, 214, 10, 0.35);
}

pre.hljs.wrap {
    white-space: pre-wrap;
}

.preview {
    font-size: 11px;
    opacity: .8;
    padding: 8px;
}

/* Improve MiniMap visibility */
.react-flow__minimap {
    background: #0f1115 !important;
    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.06) inset;
}

.react-flow__minimap-mask {
    fill: rgba(255, 255, 255, 0.06) !important;
}

.react-flow__minimap-node {
    fill: #4f46e5 !important;
    stroke: rgba(255, 255, 255, 0.2) !important;
}

/* hide folder/group nodes from minimap to reduce clutter */
.react-flow__minimap-node.group {
    display: none !important;
}

/* Allow extreme zooming */
.react-flow__renderer,
.react-flow__viewport {
    will-change: transform;
}

/* Smooth node transitions for layout/elevation changes */
.react-flow__node {
    transition: transform 220ms cubic-bezier(0.22, 1, 0.36, 1), opacity 160ms ease;
    will-change: transform;
}

/* Disable transition while dragging to keep the interaction snappy */
.react-flow__node.no-animate {
    transition: none !important;
}

@media (prefers-reduced-motion: reduce) {
    .react-flow__node {
        transition: none !important;
    }
}

/* Smooth transform transitions for the React Flow viewport (zoom smoothing) */
.react-flow__viewport {
    transition: none;
}

.react-flow__viewport.zoom-smooth {
    transition: transform var(--zoom-duration) var(--ease-smooth);
}

/* Disable smoothing during pans/drags for snappy feel */
.react-flow__viewport.no-animate {
    transition: none !important;
}

/* Placeholder body shown when code is hidden for performance */
.node-placeholder-body {
    height: calc(100% - 30px);
    display: grid;
    place-items: center;
    align-content: center;
    gap: 6px;
    color: #94a3b8;
    font-size: 12px;
    opacity: 0.9;
    cursor: grab;
}

.node-placeholder-title {
    font-weight: 900;
    line-height: 1.1;
    letter-spacing: 0.2px;
}

/* Defer offscreen work for heavy node content */
.code-card {
    /* disable content-visibility for nested group rendering to ensure code is painted */
    content-visibility: visible;
    contain-intrinsic-size: 480px 280px;
    contain: layout paint size;
}

/* Promote nodes to their own layer to reduce flicker during viewport moves */
.file-node {
    backface-visibility: hidden;
    transform: translateZ(0);
    position: relative;
    /* enable proper z-index layering for overlays */
}

/* keep code content below overlays */
.code-card {
    z-index: 1;
    position: relative;
}

.file-node-header {
    z-index: 2;
    position: relative;
}

.group-label {
    z-index: 1001;
    position: absolute;
    pointer-events: none;
}

/* Hover label should sit on top of everything inside the node */
.label-constant {
    z-index: 1002;
}

/* Show constant label also when selected */
.react-flow__node.selected .label-constant {
    opacity: 1;
}

/* Group node styles */
.react-flow__node-group {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding-top: 30px;
    min-width: 200px;
    min-height: 150px;
    cursor: grab;
    /* don't block inner node interactions */
    pointer-events: auto;
}

/* file nodes should render above groups */
.react-flow__node-file {
    z-index: 2;
}

.react-flow__node-group:hover {
    border-color: rgba(255, 255, 255, 0.3);
}

.group-label {
    position: absolute;
    top: 5px;
    left: 15px;
    font-size: 12px;
    color: #aaa;
    font-weight: 600;
}

/* zoom-aware label sizing and persistence */
:root {
    --label-min-size: 13px;
    --label-max-size: 18px;
}

.label-fixed {
    font-size: clamp(var(--label-min-size), calc(12px / var(--rf-zoom, 1)), var(--label-max-size));
    line-height: 1.2;
}

/* Group container and selection highlight */
.group-node {
    width: 100%;
    height: 100%;
    position: relative;
}

.group-node[data-selected="true"]::after {
    content: '';
    position: absolute;
    inset: 0;
    border: 3px solid rgba(99, 102, 241, 0.75);
    border-radius: 12px;
    pointer-events: none;
}

/* Existing group visuals */
.react-flow__node-group {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding-top: 30px;
    min-width: 200px;
    min-height: 150px;
    cursor: grab;
    pointer-events: auto;
}

/* File header stays visible and scales */
.file-node-header.label-fixed {
    position: sticky;
    top: 0;
    background: #0b1220;
    z-index: 2;
}

/* Large header placeholder when code is hidden */
.node-placeholder-body::before {
    content: attr(data-label);
    display: block;
    font-weight: 800;
    font-size: clamp(22px, calc(440px / var(--rf-zoom, 1)), 72px);
    /* scale with node width via container queries below */
    color: #cdd6f4;
    opacity: 0.9;
    margin-bottom: 8px;
    text-wrap: balance;
    text-align: center;
}

/* Grow placeholder header to fit node width */
@container node-size (min-width: 600px) {
    .node-placeholder-body::before {
        font-size: clamp(28px, calc(660px / var(--rf-zoom, 1)), 92px);
    }
}

/* Establish container context on file-node */
.file-node {
    container-type: inline-size;
}

/* Stronger focus for accessibility */
.react-flow__node:focus-within .file-node-header,
.react-flow__node:focus-within .group-label {
    outline: 2px solid #93c5fd;
    outline-offset: 2px;
}

/* Hover/active emphasis for nodes */
.react-flow__node:hover .file-node-header,
.react-flow__node:hover .group-label {
    color: #e5e7eb;
}

.react-flow__node:where(.selected),
.react-flow__node:is(.selected) {
    filter: drop-shadow(0 0 0.4rem rgba(99, 102, 241, 0.45));
}

.react-flow__node:hover .file-node,
.react-flow__node:hover.react-flow__node-group {
    box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.25) inset;
}

/* Larger label when hovered or selected for legibility */
.react-flow__node:hover .label-fixed,
.react-flow__node.selected .label-fixed {
    font-weight: 800;
    letter-spacing: 0.2px;
    text-shadow: 0 1px 0 rgba(0, 0, 0, 0.25);
}

/* Zoom-aware larger sizes for headers (override base) */
.file-node-header.label-fixed {
    font-size: clamp(16px, calc(24px / var(--rf-zoom, 1)), 28px);
}

.group-label.label-fixed {
    font-size: clamp(16px, calc(22px / var(--rf-zoom, 1)), 26px);
}

/* Dramatic hover/selected for headers */
.react-flow__node:hover .file-node-header.label-fixed,
.react-flow__node.selected .file-node-header.label-fixed {
    text-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
    color: #fafafa;
    background: linear-gradient(180deg, #111a2b, #0b1220);
}

.react-flow__node:hover .group-label.label-fixed,
.react-flow__node.selected .group-label.label-fixed {
    text-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
    color: #e5e7eb;
}

/* Stronger selected visuals on containers */
.react-flow__node.selected .file-node {
    box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.9) inset, 0 0 24px rgba(167, 139, 250, 0.45);
}

.react-flow__node.selected.react-flow__node-group {
    border-color: rgba(167, 139, 250, 0.9) !important;
    background: rgba(167, 139, 250, 0.08);
}

/* Constant-size hover label that ignores viewport zoom */
.label-constant {
    position: fixed;
    inset: auto auto auto auto;
    padding: 6px 10px;
    font-size: 14px;
    line-height: 1.2;
    font-weight: 800;
    background: rgba(2, 6, 23, 0.85);
    border: 1px solid rgba(99, 102, 241, 0.6);
    border-radius: 8px;
    color: #e5e7eb;
    pointer-events: none;
    opacity: 1;
    transform: translateZ(0);
    transition: opacity 120ms var(--ease-smooth), transform 120ms var(--ease-smooth);
    z-index: 2147483646;
}

/* Show on hover or focus */
.react-flow__node:hover .label-constant,
.react-flow__node:focus-within .label-constant {
    opacity: 1;
    transform: translateY(-2px);
    z-index: 3;
}

/* Increase top padding for groups much more to avoid overlap with inner nodes */
.react-flow__node-group {
    padding-top: 60px;
}

/* Keep group label elevated above children */
.group-label {
    top: 14px;
    left: 18px;
}

/* Remove in-node label-constant visibility reliance; global overlay handles hover */
.react-flow__node .label-constant {
    display: none;
}

/* Edge visibility and selection emphasis */
.react-flow__edge .react-flow__edge-path {
    stroke-linecap: round;
    stroke-linejoin: round;
}

/* Hover emphasis on edges for quicker targeting */
.react-flow__edge:hover .react-flow__edge-path {
    stroke-width: 3 !important;
}

/* Selected edge: thicker line, brighter color, subtle glow */
.react-flow__edge.selected .react-flow__edge-path {
    stroke: #a78bfa !important;
    stroke-width: 5 !important;
    filter: drop-shadow(0 0 6px rgba(167, 139, 250, 0.65)) drop-shadow(0 0 2px rgba(167, 139, 250, 0.8));
}

/* Improve visibility when a connected node is hovered/selected (ReactFlow applies .selected on nodes) */
.react-flow__node:hover ~ .react-flow__edges path,
.react-flow__node.selected ~ .react-flow__edges path {
    stroke-linecap: round;
}

/* Accessibility: stronger emphasis when user requests more contrast */
@media (prefers-contrast: more) {
    .react-flow__edge.selected .react-flow__edge-path {
        stroke-width: 7 !important;
    }
    .react-flow__node.selected .file-node {
        box-shadow: 0 0 0 4px rgba(167, 139, 250, 0.95) inset, 0 0 28px rgba(167, 139, 250, 0.55);
    }
}

/* Windows High Contrast mode support */
@media (forced-colors: active) {
    .react-flow__edge.selected .react-flow__edge-path {
        forced-color-adjust: none;
        stroke: Highlight !important;
    }
    .react-flow__node.selected .file-node {
        forced-color-adjust: none;
        outline: 3px solid Highlight;
        outline-offset: 2px;
    }
}

/* Linked node emphasis (selected or connected to selected) */
.react-flow__node.node-linked .file-node,
.react-flow__node.selected .file-node {
    box-shadow: 0 0 0 calc(3px * max(1, 1 / var(--rf-zoom, 1))) rgba(167, 139, 250, 0.9) inset,
        0 0 calc(24px * max(1, 1 / var(--rf-zoom, 1))) rgba(167, 139, 250, 0.45);
}

/* Also boost label contrast for linked nodes */
.react-flow__node.node-linked .file-node-header.label-fixed,
.react-flow__node.node-linked .group-label.label-fixed {
    color: #fafafa;
    text-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
}

/* Zoom-compensated edge thickness for linked edges */
.react-flow__edge.edge-linked .react-flow__edge-path {
    stroke-width: calc(4px * max(1, 1 / var(--rf-zoom, 1))) !important;
    filter: drop-shadow(0 0 calc(6px * max(1, 1 / var(--rf-zoom, 1))) rgba(167, 139, 250, 0.6));
}

/* When very zoomed out, force a minimum thickness so edges stay visible */
@supports (selector(:has(*))) {
    /* No-op feature query placeholder to ensure older browsers ignore if needed */
}

/* Fallback for environments not honoring CSS var or calc: keep a decent width */
.react-flow__edge.edge-linked .react-flow__edge-path {
    stroke-linecap: round;
}

@media (forced-colors: active) {
    .react-flow__node.node-linked .file-node {
        outline: 3px solid Highlight;
        outline-offset: 2px;
    }
}